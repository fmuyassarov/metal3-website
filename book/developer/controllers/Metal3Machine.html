<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Metal3Machine - Metal³ Book</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../../favicon.svg">
        
        
        <link rel="shortcut icon" href="../../favicon.png">
        
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="../../overview/project-overview.html"><strong aria-hidden="true">1.</strong> Project Overview</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../overview/metal3-components.html"><strong aria-hidden="true">1.1.</strong> Metal³ Components</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../overview/capm3/capm3.html"><strong aria-hidden="true">1.1.1.</strong> Cluster-Api-Provider-Metal³</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../overview/capm3/workflow.html"><strong aria-hidden="true">1.1.1.1.</strong> Workflow</a></li><li class="chapter-item expanded "><a href="../../overview/capm3/api.html"><strong aria-hidden="true">1.1.1.2.</strong> API concepts</a></li></ol></li><li class="chapter-item expanded "><a href="../../overview/bmo/bmo.html"><strong aria-hidden="true">1.1.2.</strong> Baremetal Operator</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../overview/bmo/ironic-integration.html"><strong aria-hidden="true">1.1.2.1.</strong> Ironic Integration</a></li><li class="chapter-item expanded "><a href="../../overview/bmo/bmh-states.html"><strong aria-hidden="true">1.1.2.2.</strong> BaremetalHost Provisioning States</a></li><li class="chapter-item expanded "><a href="../../overview/bmo/workflow.html"><strong aria-hidden="true">1.1.2.3.</strong> Workflow</a></li><li class="chapter-item expanded "><a href="../../overview/bmo/api.html"><strong aria-hidden="true">1.1.2.4.</strong> API concepts</a></li></ol></li><li class="chapter-item expanded "><a href="../../overview/metal3-dev-env.html"><strong aria-hidden="true">1.1.3.</strong> Metal³-Dev-Env</a></li><li class="chapter-item expanded "><a href="../../overview/ipam/ip-address-manager.html"><strong aria-hidden="true">1.1.4.</strong> Ip-Address-Manager</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../overview/ipam/workflow.html"><strong aria-hidden="true">1.1.4.1.</strong> Workflow</a></li><li class="chapter-item expanded "><a href="../../overview/ipam/api.html"><strong aria-hidden="true">1.1.4.2.</strong> API concepts</a></li></ol></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../developer/developer-guide.html"><strong aria-hidden="true">2.</strong> Developer Guide</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../developer/testing.html"><strong aria-hidden="true">2.1.</strong> Testing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../developer/testing/metal3-dev-env.html"><strong aria-hidden="true">2.1.1.</strong> Metal³-Dev-Env</a></li><li class="chapter-item expanded "><a href="../../developer/testing/tilt.html"><strong aria-hidden="true">2.1.2.</strong> Tilt</a></li></ol></li><li class="chapter-item expanded "><a href="../../developer/contollers.html"><strong aria-hidden="true">2.2.</strong> Custom Resources</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../developer/controllers/Metal3Cluster.html"><strong aria-hidden="true">2.2.1.</strong> Metal3Cluster</a></li><li class="chapter-item expanded "><a href="../../developer/controllers/Metal3Machine.html" class="active"><strong aria-hidden="true">2.2.2.</strong> Metal3Machine</a></li><li class="chapter-item expanded "><a href="../../developer/controllers/BareMetalHost.html"><strong aria-hidden="true">2.2.3.</strong> BareMetalHost</a></li><li class="chapter-item expanded "><a href="../../developer/controllers/Metal3MachineTemplate.html"><strong aria-hidden="true">2.2.4.</strong> Metal3MachineTemplate</a></li><li class="chapter-item expanded "><a href="../../developer/controllers/IpPool.html"><strong aria-hidden="true">2.2.5.</strong> IpPool</a></li><li class="chapter-item expanded "><a href="../../developer/controllers/IpClaim.html"><strong aria-hidden="true">2.2.6.</strong> IpClaim</a></li><li class="chapter-item expanded "><a href="../../developer/controllers/IpAddress.html"><strong aria-hidden="true">2.2.7.</strong> IpAddress</a></li><li class="chapter-item expanded "><a href="../../developer/controllers/Metal3Data.html"><strong aria-hidden="true">2.2.8.</strong> Metal3Data</a></li><li class="chapter-item expanded "><a href="../../developer/controllers/Metal3DataClaim.html"><strong aria-hidden="true">2.2.9.</strong> Metal3DataClaim</a></li><li class="chapter-item expanded "><a href="../../developer/controllers/Metal3DataTemplate.html"><strong aria-hidden="true">2.2.10.</strong> Metal3DataTemplate</a></li></ol></li><li class="chapter-item expanded "><a href="../../developer/relational_diagram.html"><strong aria-hidden="true">2.3.</strong> Custom Resource Relational Diagram</a></li></ol></li><li class="chapter-item expanded "><a href="../../references/references.html"><strong aria-hidden="true">3.</strong> References</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../references/glossary.html"><strong aria-hidden="true">3.1.</strong> Glossary</a></li><li class="chapter-item expanded "><a href="../../references/code-of-conduct.html"><strong aria-hidden="true">3.2.</strong> Code of Conduct</a></li><li class="chapter-item expanded "><a href="../../references/contribution.html"><strong aria-hidden="true">3.3.</strong> Contribution</a></li><li class="chapter-item expanded "><a href="../../references/roadmap.html"><strong aria-hidden="true">3.4.</strong> Roadmap</a></li></ol></li><li class="chapter-item expanded "><a href="../../mdbook.html"><strong aria-hidden="true">4.</strong> Multi-repo Test with Mdbook</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../submodules/bmo/docs/api.html"><strong aria-hidden="true">4.1.</strong> BMO</a></li><li class="chapter-item expanded "><a href="../../submodules/capm3/docs/api.html"><strong aria-hidden="true">4.2.</strong> CAPM3</a></li><li class="chapter-item expanded "><a href="../../submodules/dev-env/index.html"><strong aria-hidden="true">4.3.</strong> Metal3-dev-env</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Metal³ Book</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        <a href="https://github.com/metal3-io" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#metal3machine" id="metal3machine">Metal3Machine</a></h1>
<p>The Metal3Machine contains information related to the deployment of the
BareMetalHost such as the image and the host selector. For each machine, there
must be a Metal3Machine associated to it.</p>
<h2><a class="header" href="#metal3machine-example" id="metal3machine-example">Metal3Machine Example</a></h2>
<pre><code class="language-yaml">apiVersion: infrastructure.cluster.x-k8s.io/v1alpha4
kind: Metal3Machine
metadata:
  name: controlplane-0
spec:
  image:
    url: https://cloud-images.ubuntu.com/bionic/current/bionic-server-cloudimg-amd64.img
    checksum: https://cloud-images.ubuntu.com/bionic/current/bionic-server-cloudimg-amd64.img.md5sum
  hostSelector:
    matchLabels:
      key1: value1
    matchExpressions:
      key: key2
      operator: in
      values: {‘abc’, ‘123’, ‘value2’}
  dataTemplate:
    Name: controlplane-metadata
  metaData:
    Name: controlplane-0-metadata-0
</code></pre>
<h2><a class="header" href="#metal3machine-spec" id="metal3machine-spec">Metal3Machine spec</a></h2>
<h4><a class="header" href="#image" id="image">image</a></h4>
<p>This includes two sub-fields, <code>url</code> and <code>checksum</code>, which
include the URL to the image and the URL to a checksum for that image. These
fields are required. The image will be used for provisioning of the
<code>BareMetalHost</code> chosen by the <code>Machine</code> actuator.</p>
<h4><a class="header" href="#userdata" id="userdata">userData</a></h4>
<p>This includes two sub-fields, <code>name</code> and <code>namespace</code>, which
reference a <code>Secret</code> that contains base64 encoded user-data to be written to
a config drive on the provisioned <code>BareMetalHost</code>. This field is optional and
is automatically set by CAPM3 with the userData from the machine object. If
you want to overwrite the userData, this should be done in the CAPI machine.</p>
<h4><a class="header" href="#datatemplate" id="datatemplate">dataTemplate</a></h4>
<p>This includes a reference to a Metal3DataTemplate object
containing the metadata and network data templates, and includes two fields,
<code>name</code> and <code>namespace</code>.</p>
<h4><a class="header" href="#metadata" id="metadata">metaData</a></h4>
<p>A reference to a secret containing the metadata rendered from
the Metal3DataTemplate metadata template object automatically. In case this
would not be managed by the Metal3DataTemplate controller, if provided by the
user for example, the ownerreference should be set properly to ensure that the
secret belongs to the cluster ownerReference tree (see
<a href="https://cluster-api.sigs.k8s.io/clusterctl/provider-contract.html#ownerreferences-chain">doc</a>).</p>
<h4><a class="header" href="#networkdata" id="networkdata">networkData</a></h4>
<p>A reference to a secret containing the network data
rendered from the Metal3DataTemplate metadata template object automatically.
In case this would not be managed by the Metal3DataTemplate controller, if
provided by the user for example, the ownerreference should be set properly to
ensure that the secret belongs to the cluster ownerReference tree (see
<a href="https://cluster-api.sigs.k8s.io/clusterctl/provider-contract.html#ownerreferences-chain">doc</a>).
The content of the secret should be a yaml equivalent of a json object that
follows the format definition that can be found
<a href="https://docs.openstack.org/nova/latest/_downloads/9119ca7ac90aa2990e762c08baea3a36/network_data.json">here</a>.</p>
<h4><a class="header" href="#hostselector" id="hostselector">hostSelector</a></h4>
<p>Specifies criteria for matching labels on <code>BareMetalHost</code>
objects. This can be used to limit the set of available <code>BareMetalHost</code>
objects chosen for this <code>Machine</code>.</p>
<p>The <code>metaData</code> and <code>networkData</code> field in the <code>spec</code> section are for the user
to give directly a secret to use as metaData or networkData. The <code>userData</code>,
<code>metaData</code> and <code>networkData</code> fields in the <code>status</code> section are for the
controller to store the reference to the secret that is actually being used,
whether it is from one of the spec fields, or somehow generated. This is aimed
at making a clear difference between the desired state from the user (whether
it is with a DataTemplate reference, or direct <code>metaData</code> or <code>userData</code> secrets)
and what the controller is actually using.</p>
<p>The <code>dataTemplate</code> field consists of an object reference to a
Metal3DataTemplate object containing the templates for the metadata and
network data generation for this Metal3Machine. The <code>renderedData</code> field is a
reference to the Metal3Data object created for this machine. If the
dataTemplate field is set but either the <code>renderedData</code>, <code>metaData</code> or
<code>networkData</code> fields in the status are unset, then the Metal3Machine
controller will wait until it can find the Metal3Data object and the rendered
secrets. It will then populate those fields.</p>
<p>When CAPM3 controller will set the different fields in the BareMetalHost,
it will reference the metadata secret and the network data secret
in the BareMetalHost. If any of the <code>metaData</code> or <code>networkData</code> status fields
are unset, that field will also remain unset on the BareMetalHost.</p>
<p>When the Metal3Machine gets deleted, the CAPM3 controller will remove its
ownerreference from the data template object. This will trigger the deletion of
the generated Metal3Data object and the secrets generated for this machine.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../../developer/controllers/Metal3Cluster.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../../developer/controllers/BareMetalHost.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../../developer/controllers/Metal3Cluster.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../../developer/controllers/BareMetalHost.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
